<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Halaman Transaksi</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
        }
        .container {
            max-width: 1000px;
        }
        .modal-lg {
            max-width: 90% !important;
        }
    </style>
</head>
<body>
    <div class="container mt-5">
        <h2 class="text-center mb-4"><i class="fas fa-cash-register"></i> Halaman Transaksi</h2>

        <!-- Form Pilih Jenis Transaksi -->
        <div class="mb-4">
            <label for="transaksiJenis" class="form-label">Jenis Transaksi</label>
            <select class="form-select" id="transaksiJenis">
                <option value="umum">Umum</option>
                <option value="member">Member</option>
            </select>
        </div>

        <!-- Form Input Manual (Umum) -->
        <form id="formUmum" class="mb-4">
            <h5>Transaksi Umum</h5>
            <div class="mb-3">
                <label for="produkNama" class="form-label">Nama Produk</label>
                <input type="text" class="form-control" id="produkNamaUmum" placeholder="Masukkan nama produk">
            </div>
            <div class="mb-3">
                <label for="produkHarga" class="form-label">Harga</label>
                <input type="number" class="form-control" id="produkHargaUmum" placeholder="Masukkan harga">
            </div>
            <div class="mb-3">
                <label for="jumlahProduk" class="form-label">Jumlah</label>
                <input type="number" class="form-control" id="jumlahProdukUmum" placeholder="Masukkan jumlah">
            </div>
            <div class="mb-3">
                <label for="diskonProduk" class="form-label">Diskon (%)</label>
                <input type="number" class="form-control" id="diskonProdukUmum" placeholder="Masukkan diskon (jika ada)">
            </div>
            <button type="submit" class="btn btn-primary w-100"><i class="fas fa-save"></i> Simpan Transaksi Umum</button>
        </form>

        <!-- Form Relasi Data (Member) -->
        <div id="formMember" class="d-none mb-4">
            <h5>Transaksi Member</h5>
            <div class="mb-3">
                <label for="memberId" class="form-label">Pilih Member</label>
                <select class="form-select" id="memberId">
                    <!-- Data Member akan dimuat di sini -->
                </select>
            </div>
            <div class="mb-3">
                <label for="produkId" class="form-label">Pilih Produk</label>
                <select class="form-select" id="produkId">
                    <!-- Data Produk akan dimuat di sini -->
                </select>
            </div>
            <div class="mb-3">
                <label for="jumlahProdukMember" class="form-label">Jumlah</label>
                <input type="number" class="form-control" id="jumlahProdukMember" placeholder="Masukkan jumlah">
            </div>
            <button class="btn btn-primary w-100" id="tambahTransaksiMember"><i class="fas fa-save"></i> Tambah ke Keranjang</button>
        </div>

        <!-- Tabel Transaksi -->
        <h5 class="mt-4">Daftar Transaksi</h5>
        <table class="table table-striped" id="transaksiTable">
            <thead>
                <tr>
                    <th>ID Transaksi</th>
                    <th>Nama Produk</th>
                    <th>Harga</th>
                    <th>Jumlah</th>
                    <th>Diskon</th>
                    <th>Total</th>
                    <th>Aksi</th>
                </tr>
            </thead>
            <tbody>
                <!-- Data transaksi akan dimuat di sini -->
            </tbody>
        </table>

        <!-- Total Pembayaran -->
        <div class="d-flex justify-content-between align-items-center mt-3">
            <h5>Total Pembayaran: <span id="totalPembayaran">Rp 0</span></h5>
            <button class="btn btn-success" id="konfirmasiPembayaran"><i class="fas fa-check-circle"></i> Konfirmasi Pembayaran</button>
        </div>
    </div>

    <script>
        const transaksiList = JSON.parse(localStorage.getItem("transaksi")) || [];
        const produkList = JSON.parse(localStorage.getItem("produk")) || [];
        const memberList = JSON.parse(localStorage.getItem("member")) || [];

        const renderTransaksiTable = () => {
            const tableBody = document.getElementById("transaksiTable").getElementsByTagName("tbody")[0];
            tableBody.innerHTML = "";
            let totalPembayaran = 0;

            transaksiList.forEach((transaksi, index) => {
                const row = tableBody.insertRow();
                row.insertCell(0).textContent = transaksi.id;
                row.insertCell(1).textContent = transaksi.namaProduk;
                row.insertCell(2).textContent = `Rp ${transaksi.harga}`;
                row.insertCell(3).textContent = transaksi.jumlah;
                row.insertCell(4).textContent = `${transaksi.diskon}%`;
                row.insertCell(5).textContent = `Rp ${transaksi.total}`;
                totalPembayaran += transaksi.total;

                const aksiCell = row.insertCell(6);
                const deleteButton = document.createElement("button");
                deleteButton.className = "btn btn-danger btn-sm";
                deleteButton.innerHTML = '<i class="fas fa-trash"></i>';
                deleteButton.onclick = () => deleteTransaksi(index);
                aksiCell.appendChild(deleteButton);
            });

            document.getElementById("totalPembayaran").textContent = `Rp ${totalPembayaran}`;
        };

        const deleteTransaksi = (index) => {
            if (confirm("Apakah Anda yakin ingin menghapus transaksi ini?")) {
                transaksiList.splice(index, 1);
                localStorage.setItem("transaksi", JSON.stringify(transaksiList));
                renderTransaksiTable();
            }
        };

        const saveTransaksiUmum = (event) => {
            event.preventDefault();
            const id = `TRX-${new Date().getTime()}`;
            const namaProduk = document.getElementById("produkNamaUmum").value;
            const harga = parseFloat(document.getElementById("produkHargaUmum").value) || 0;
            const jumlah = parseInt(document.getElementById("jumlahProdukUmum").value) || 0;
            const diskon = parseFloat(document.getElementById("diskonProdukUmum").value) || 0;
            const total = (harga * jumlah) - (harga * jumlah * diskon / 100);

            transaksiList.push({ id, namaProduk, harga, jumlah, diskon, total });
            localStorage.setItem("transaksi", JSON.stringify(transaksiList));
            renderTransaksiTable();
            event.target.reset();
        };

        const renderProdukOptions = () => {
            const produkSelect = document.getElementById("produkId");
            produkSelect.innerHTML = "";
            produkList.forEach(produk => {
                const option = document.createElement("option");
                option.value = produk.id;
                option.textContent = produk.nama;
                produkSelect.appendChild(option);
            });
        };

        const renderMemberOptions = () => {
            const memberSelect = document.getElementById("memberId");
            memberSelect.innerHTML = "";
            memberList.forEach(member => {
                const option = document.createElement("option");
                option.value = member.id;
                option.textContent = member.nama;
                memberSelect.appendChild(option);
            });
        };

        document.getElementById("transaksiJenis").addEventListener("change", (event) => {
            const jenis = event.target.value;
            document.getElementById("formUmum").classList.toggle("d-none", jenis !== "umum");
            document.getElementById("formMember").classList.toggle("d-none", jenis !== "member");
        });

        document.getElementById("formUmum").addEventListener("submit", saveTransaksiUmum);

        renderTransaksiTable();
        renderProdukOptions();
        renderMemberOptions();
    </script>
</body>
</html>
