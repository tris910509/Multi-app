<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Halaman Transaksi</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
        }
        .container {
            max-width: 1200px;
        }
        .table th, .table td {
            vertical-align: middle;
        }
        .form-control:disabled {
            background-color: #e9ecef;
        }
    </style>
</head>
<body>
    <div class="container mt-5">
        <h2 class="text-center mb-4"><i class="fas fa-shopping-cart"></i> Form Transaksi</h2>

        <!-- Form Transaksi -->
        <div class="card">
            <div class="card-header"><strong>Form Transaksi</strong></div>
            <div class="card-body">
                <form id="formTransaksi">
                    <!-- ID Transaksi -->
                    <div class="mb-3">
                        <label for="idTransaksi" class="form-label">ID Transaksi</label>
                        <input type="text" class="form-control" id="idTransaksi" value="TRX-{{Date.now()}}" disabled>
                    </div>

                    <!-- Jenis Pelanggan -->
                    <div class="mb-3">
                        <label for="jenisPelanggan" class="form-label">Jenis Pelanggan</label>
                        <select class="form-select" id="jenisPelanggan" onchange="ubahJenisPelanggan()">
                            <option value="umum">Umum</option>
                            <option value="member">Member</option>
                        </select>
                    </div>

                    <!-- Nama Pelanggan -->
                    <div class="mb-3">
                        <label for="namaPelanggan" class="form-label">Nama Pelanggan</label>
                        <input type="text" class="form-control" id="namaPelanggan" disabled>
                    </div>

                    <!-- Form Keranjang -->
                    <div class="mb-3">
                        <label for="produk" class="form-label">Produk</label>
                        <select class="form-select" id="produk">
                            <option value="">Pilih Produk</option>
                            <!-- Produk diisi dengan data -->
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="jumlah" class="form-label">Jumlah</label>
                        <input type="number" class="form-control" id="jumlah" min="1" value="1">
                    </div>
                    <div class="mb-3">
                        <label for="diskon" class="form-label">Diskon (Rp)</label>
                        <input type="number" class="form-control" id="diskon" min="0" value="0">
                    </div>
                    <div class="mb-3">
                        <button type="button" class="btn btn-primary" id="btnTambahKeranjang">Tambah ke Keranjang</button>
                    </div>

                    <!-- Keranjang -->
                    <h5>Keranjang</h5>
                    <table class="table table-bordered" id="keranjang">
                        <thead>
                            <tr>
                                <th>No.</th>
                                <th>Nama Produk</th>
                                <th>Item</th>
                                <th>Harga</th>
                                <th>Diskon</th>
                                <th>Jumlah</th>
                                <th>Total</th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="keranjangItems"></tbody>
                    </table>

                    <div class="mb-3">
                        <label for="totalBelanja" class="form-label">Total Belanja</label>
                        <input type="text" class="form-control" id="totalBelanja" disabled>
                    </div>

                    <!-- Form Pembayaran -->
                    <h5>Pembayaran</h5>
                    <div class="mb-3">
                        <label for="totalBayar" class="form-label">Total yang Harus Dibayar</label>
                        <input type="text" class="form-control" id="totalBayar" disabled>
                    </div>
                    <div class="mb-3">
                        <label for="jumlahBayar" class="form-label">Jumlah Pembayaran</label>
                        <input type="number" class="form-control" id="jumlahBayar">
                    </div>
                    <div class="mb-3">
                        <label for="kembalian" class="form-label">Kembalian</label>
                        <input type="text" class="form-control" id="kembalian" disabled>
                    </div>

                    <!-- Status Pembayaran -->
                    <div class="mb-3">
                        <label for="statusPembayaran" class="form-label">Status Pembayaran</label>
                        <input type="text" class="form-control" id="statusPembayaran" disabled>
                    </div>

                    <!-- Metode Pembayaran -->
                    <div class="mb-3">
                        <label for="metodePembayaran" class="form-label">Metode Pembayaran</label>
                        <select class="form-select" id="metodePembayaran">
                            <option value="cash">Cash</option>
                            <option value="transfer">Transfer (QR / E-wallet)</option>
                        </select>
                    </div>
                    <div class="mb-3" id="buktiPembayaran" style="display:none;">
                        <label for="bukti" class="form-label">Bukti Pembayaran</label>
                        <input type="file" class="form-control" id="bukti">
                    </div>

                    <!-- Simpan dan Konfirmasi -->
                    <button type="button" class="btn btn-success" id="btnSimpanTransaksi">Simpan Transaksi</button>
                </form>
            </div>
        </div>

        <!-- Riwayat Transaksi -->
        <h3 class="mt-5">Riwayat Transaksi</h3>
        <table class="table table-bordered" id="riwayatTransaksi">
            <thead>
                <tr>
                    <th>ID Transaksi</th>
                    <th>Nama Produk</th>
                    <th>Total Pembayaran</th>
                    <th>Status Pembayaran</th>
                    <th>Aksi</th>
                </tr>
            </thead>
            <tbody id="riwayatTransaksiBody"></tbody>
        </table>
    </div>

    <script>
        // Dummy data produk dan pelanggan
        const produkData = [
            { id: 1, nama: 'Produk A', harga: 50000 },
            { id: 2, nama: 'Produk B', harga: 75000 },
            { id: 3, nama: 'Produk C', harga: 100000 }
        ];

        const pelangganData = [
            { id: 1, nama: 'John Doe', jenis: 'member' },
            { id: 2, nama: 'Jane Smith', jenis: 'umum' }
        ];

        let keranjang = [];
        let totalBelanja = 0;

        // Menampilkan produk
        const tampilkanProduk = () => {
            const produkSelect = document.getElementById('produk');
            produkData.forEach(p => {
                const option = document.createElement('option');
                option.value = p.id;
                option.textContent = p.nama;
                produkSelect.appendChild(option);
            });
        };

        // Menampilkan pelanggan berdasarkan ID
        const tampilkanPelanggan = (id) => {
            const pelanggan = pelangganData.find(p => p.id === id);
            if (pelanggan) {
                document.getElementById('namaPelanggan').value = pelanggan.nama;
            }
        };

        // Menambahkan item ke keranjang
        const tambahKeKeranjang = () => {
            const produkId = document.getElementById('produk').value;
            const produk = produkData.find(p => p.id == produkId);
            const jumlah = parseInt(document.getElementById('jumlah').value);
            const diskon = parseInt(document.getElementById('diskon').value);

            if (produk) {
                const total = (produk.harga * jumlah) - diskon;
                keranjang.push({ produk, jumlah, diskon, total });

                totalBelanja += total;
                document.getElementById('totalBelanja').value = `Rp ${totalBelanja}`;
                tampilkanKeranjang();
            }
        };

        // Menampilkan keranjang
        const tampilkanKeranjang = () => {
            const keranjangTable = document.getElementById('keranjangItems');
            keranjangTable.innerHTML = '';
            keranjang.forEach((item, index) => {
                keranjangTable.innerHTML += `
                    <tr>
                        <td>${index + 1}</td>
                        <td>${item.produk.nama}</td>
                        <td>${item.jumlah}</td>
                        <td>Rp ${item.produk.harga}</td>
                        <td>Rp ${item.diskon}</td>
                        <td>${item.jumlah}</td>
                        <td>Rp ${item.total}</td>
                        <td><button class="btn btn-danger btn-sm" onclick="hapusItemKeranjang(${index})">Hapus</button></td>
                    </tr>
                `;
            });
        };

        // Menghapus item dari keranjang
        const hapusItemKeranjang = (index) => {
            totalBelanja -= keranjang[index].total;
            document.getElementById('totalBelanja').value = `Rp ${totalBelanja}`;
            keranjang.splice(index, 1);
            tampilkanKeranjang();
        };

        // Menangani pembayaran dan status
        const konfirmasiPembayaran = () => {
            const metode = document.getElementById('metodePembayaran').value;
            const jumlahBayar = parseInt(document.getElementById('jumlahBayar').value);
            const totalBayar = totalBelanja;

            if (metode === 'cash') {
                const kembalian = jumlahBayar - totalBayar;
                document.getElementById('kembalian').value = `Rp ${kembalian}`;
                document.getElementById('statusPembayaran').value = (kembalian >= 0) ? 'Lunas' : 'Belum Lunas';
            } else if (metode === 'transfer') {
                document.getElementById('buktiPembayaran').style.display = 'block';
            }
        };

        // Menyimpan transaksi
        const simpanTransaksi = () => {
            const transaksi = {
                idTransaksi: document.getElementById('idTransaksi').value,
                produk: keranjang,
                totalPembayaran: totalBelanja,
                statusPembayaran: document.getElementById('statusPembayaran').value
            };

            // Simpan transaksi ke localStorage atau ke database sesuai kebutuhan
            let transaksiHistory = JSON.parse(localStorage.getItem('transaksiHistory')) || [];
            transaksiHistory.push(transaksi);
            localStorage.setItem('transaksiHistory', JSON.stringify(transaksiHistory));

            alert('Transaksi berhasil disimpan!');
            tampilkanRiwayatTransaksi();
        };

        // Menampilkan riwayat transaksi
        const tampilkanRiwayatTransaksi = () => {
            const riwayatTransaksiTable = document.getElementById('riwayatTransaksiBody');
            const transaksiHistory = JSON.parse(localStorage.getItem('transaksiHistory')) || [];
            riwayatTransaksiTable.innerHTML = '';
            transaksiHistory.forEach(transaksi => {
                riwayatTransaksiTable.innerHTML += `
                    <tr>
                        <td>${transaksi.idTransaksi}</td>
                        <td>${transaksi.produk.map(p => p.produk.nama).join(', ')}</td>
                        <td>Rp ${transaksi.totalPembayaran}</td>
                        <td>${transaksi.statusPembayaran}</td>
                        <td><button class="btn btn-info btn-sm">Detail</button></td>
                    </tr>
                `;
            });
        };

        // Inisialisasi data produk dan pelanggan
        tampilkanProduk();
        tampilkanRiwayatTransaksi();

        document.getElementById('btnTambahKeranjang').addEventListener('click', tambahKeKeranjang);
        document.getElementById('btnSimpanTransaksi').addEventListener('click', simpanTransaksi);
        document.getElementById('metodePembayaran').addEventListener('change', konfirmasiPembayaran);

    </script>
</body>
</html>
