<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Halaman Transaksi POS</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .container {
            max-width: 1200px;
            margin: auto;
        }
        .table th, .table td {
            vertical-align: middle;
        }
        .btn-add-product {
            margin-top: 10px;
        }
    </style>
</head>
<body>

    <div class="container mt-5">
        <h1>Halaman Transaksi POS</h1>
        
        <!-- Input Data Pelanggan -->
        <div class="mb-4">
            <label for="customerName" class="form-label">Nama Pelanggan</label>
            <input type="text" class="form-control" id="customerName" placeholder="Masukkan Nama Pelanggan">
        </div>

        <!-- Daftar Produk -->
        <div class="mb-4">
            <label for="productSelect" class="form-label">Pilih Produk</label>
            <select id="productSelect" class="form-select">
                <option value="">Pilih Produk</option>
                <option value="Produk 1|50000">Produk 1 - Rp 50.000</option>
                <option value="Produk 2|30000">Produk 2 - Rp 30.000</option>
                <option value="Produk 3|15000">Produk 3 - Rp 15.000</option>
            </select>
            <button class="btn btn-primary btn-add-product" onclick="addProduct()">Tambah Produk</button>
        </div>

        <!-- Tabel Daftar Transaksi -->
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>Nama Produk</th>
                    <th>Harga</th>
                    <th>Jumlah</th>
                    <th>Total</th>
                    <th>Aksi</th>
                </tr>
            </thead>
            <tbody id="transactionTable"></tbody>
        </table>

        <!-- Total Pembayaran -->
        <div class="row mb-4">
            <div class="col-md-6">
                <h3>Total Pembayaran</h3>
                <p id="totalAmount">Rp 0</p>
            </div>
        </div>

        <!-- Metode Pembayaran -->
        <div class="mb-4">
            <h3>Pilih Metode Pembayaran</h3>
            <button class="btn btn-success" onclick="processPayment()">Proses Pembayaran</button>
        </div>

        <!-- Laporan Transaksi -->
        <h3>Laporan Transaksi</h3>
        <ul id="transactionHistory"></ul>

    </div>

    <!-- Bootstrap JS & Popper.js -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.min.js"></script>

    <script>
        let transactionData = [];
        
        // Function to add product to the transaction
        function addProduct() {
            const selectedProduct = document.getElementById('productSelect').value;
            if (selectedProduct) {
                const [productName, productPrice] = selectedProduct.split('|');
                const product = { name: productName, price: parseInt(productPrice), quantity: 1, total: parseInt(productPrice) };
                
                // Add product to transactionData
                transactionData.push(product);
                localStorage.setItem('transactionData', JSON.stringify(transactionData));
                renderTransactionTable();
                calculateTotal();
            }
        }

        // Render the transaction table
        function renderTransactionTable() {
            const transactionTable = document.getElementById('transactionTable');
            transactionTable.innerHTML = '';
            transactionData.forEach((item, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${item.name}</td>
                    <td>Rp ${item.price}</td>
                    <td>${item.quantity}</td>
                    <td>Rp ${item.total}</td>
                    <td><button class="btn btn-danger btn-sm" onclick="removeProduct(${index})">Hapus</button></td>
                `;
                transactionTable.appendChild(row);
            });
        }

        // Calculate the total amount
        function calculateTotal() {
            const totalAmount = transactionData.reduce((total, item) => total + item.total, 0);
            document.getElementById('totalAmount').innerText = `Rp ${totalAmount}`;
        }

        // Remove product from transaction
        function removeProduct(index) {
            transactionData.splice(index, 1);
            localStorage.setItem('transactionData', JSON.stringify(transactionData));
            renderTransactionTable();
            calculateTotal();
        }

        // Process the payment and save transaction in localStorage
        function processPayment() {
            const customerName = document.getElementById('customerName').value;
            if (!customerName) {
                alert('Silakan masukkan nama pelanggan.');
                return;
            }

            // Store the transaction data
            const transaction = {
                customerName,
                items: transactionData,
                total: transactionData.reduce((total, item) => total + item.total, 0),
                date: new Date().toLocaleString()
            };

            let transactionHistory = JSON.parse(localStorage.getItem('transactionHistory')) || [];
            transactionHistory.push(transaction);
            localStorage.setItem('transactionHistory', JSON.stringify(transactionHistory));
            
            // Reset transaction data
            transactionData = [];
            localStorage.removeItem('transactionData');
            renderTransactionTable();
            calculateTotal();
            showTransactionHistory();
            alert('Pembayaran berhasil!');
        }

        // Show transaction history
        function showTransactionHistory() {
            const transactionHistory = JSON.parse(localStorage.getItem('transactionHistory')) || [];
            const transactionHistoryList = document.getElementById('transactionHistory');
            transactionHistoryList.innerHTML = '';
            transactionHistory.forEach(trans => {
                const li = document.createElement('li');
                li.textContent = `Nama Pelanggan: ${trans.customerName} - Total: Rp ${trans.total} - Tanggal: ${trans.date}`;
                transactionHistoryList.appendChild(li);
            });
        }

        // Initial render
        renderTransactionTable();
        calculateTotal();
        showTransactionHistory();
    </script>
</body>
</html>
