<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Halaman Transaksi</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
        }
        .container {
            max-width: 1200px;
        }
        .cart-item {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            border: 1px solid #ddd;
            margin-bottom: 10px;
            background-color: #fff;
        }
        .alert-custom {
            display: none;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="container mt-5">
        <h2 class="text-center mb-4"><i class="fas fa-shopping-cart"></i> Halaman Transaksi</h2>

        <!-- Alert -->
        <div class="alert alert-danger alert-custom" id="errorAlert"></div>
        <div class="alert alert-success alert-custom" id="successAlert"></div>

        <!-- Form Transaksi -->
        <form id="formTransaksi">
            <h5>Transaksi Baru</h5>
            <div class="mb-3">
                <label for="idTransaksi" class="form-label">ID Transaksi</label>
                <input type="text" class="form-control" id="idTransaksi" disabled>
            </div>
            <div class="mb-3">
                <label for="jenisPelanggan" class="form-label">Jenis Pelanggan</label>
                <select class="form-select" id="jenisPelanggan">
                    <option value="umum">Umum</option>
                    <option value="semi">Semi</option>
                    <option value="member">Member</option>
                </select>
            </div>
            <div id="pelangganUmumContainer" class="mb-3">
                <label for="namaPelangganUmum" class="form-label">Nama Pelanggan</label>
                <input type="text" class="form-control" id="namaPelangganUmum" placeholder="Masukkan nama pelanggan">
            </div>
            <div id="pelangganLainContainer" class="mb-3 d-none">
                <label for="namaPelangganLain" class="form-label">Pilih Pelanggan</label>
                <select class="form-select" id="namaPelangganLain">
                    <!-- Opsi pelanggan akan dimuat di sini -->
                </select>
            </div>
            <div class="mb-3">
                <label for="produk" class="form-label">Pilih Produk</label>
                <select class="form-select" id="produk">
                    <!-- Opsi produk akan dimuat di sini -->
                </select>
            </div>
            <div class="mb-3">
                <label for="jumlah" class="form-label">Jumlah</label>
                <input type="number" class="form-control" id="jumlah" min="1" value="1">
            </div>
            <button type="button" class="btn btn-primary" id="tambahKeKeranjang"><i class="fas fa-cart-plus"></i> Tambah ke Keranjang</button>
        </form>

        <!-- Keranjang -->
        <div id="keranjang" class="mt-4">
            <h5>Keranjang Belanja</h5>
            <div id="cartItems"></div>
            <hr>
            <div class="d-flex justify-content-between">
                <h6>Subtotal: <span id="subtotal">Rp 0</span></h6>
                <h6>Total Harga: <span id="totalHarga">Rp 0</span></h6>
            </div>
            <button class="btn btn-danger w-100" id="batalkanTransaksi"><i class="fas fa-trash"></i> Batalkan Transaksi</button>
            <button class="btn btn-success w-100 mt-3" id="konfirmasiPembayaran"><i class="fas fa-check-circle"></i> Konfirmasi Pembayaran</button>
        </div>

        <!-- Konfirmasi Pembayaran -->
        <div id="konfirmasi" class="mt-5 d-none">
            <h5>Konfirmasi Pembayaran</h5>
            <div id="pembayaranInfo"></div>
            <button class="btn btn-success mt-3" onclick="selesaikanPembayaran()"><i class="fas fa-check"></i> Selesaikan</button>
        </div>
    </div>

    <script>
        const produkList = JSON.parse(localStorage.getItem("produk")) || [];
        const pelangganList = JSON.parse(localStorage.getItem("pelanggan")) || [];
        let keranjang = [];

        const generateIDTransaksi = () => `TRX-${Date.now()}`;

        const renderOptions = (selectElementId, dataList, placeholder) => {
            const selectElement = document.getElementById(selectElementId);
            selectElement.innerHTML = `<option value="" disabled selected>${placeholder}</option>`;
            dataList.forEach(item => {
                const option = document.createElement("option");
                option.value = item.id;
                option.textContent = item.nama;
                selectElement.appendChild(option);
            });
        };

        const updateKeranjang = () => {
            const keranjangDiv = document.getElementById("cartItems");
            keranjangDiv.innerHTML = "";

            let subtotal = 0;
            keranjang.forEach(item => {
                subtotal += item.totalHarga;
                keranjangDiv.innerHTML += `
                    <div class="cart-item">
                        <span>${item.nama} (x${item.jumlah})</span>
                        <span>Rp ${item.totalHarga.toLocaleString()}</span>
                        <button class="btn btn-danger btn-sm" onclick="hapusItem('${item.id}')"><i class="fas fa-trash"></i></button>
                    </div>
                `;
            });

            document.getElementById("subtotal").textContent = `Rp ${subtotal.toLocaleString()}`;
            document.getElementById("totalHarga").textContent = `Rp ${subtotal.toLocaleString()}`;
        };

        const hapusItem = (id) => {
            keranjang = keranjang.filter(item => item.id !== id);
            updateKeranjang();
        };

        const tambahItemKeKeranjang = () => {
            const produkId = document.getElementById("produk").value;
            const jumlah = parseInt(document.getElementById("jumlah").value);

            const produk = produkList.find(p => p.id === produkId);
            if (!produk) {
                alert("Produk tidak ditemukan");
                return;
            }

            const totalHarga = produk.harga * jumlah;
            keranjang.push({ ...produk, jumlah, totalHarga });
            updateKeranjang();
        };

        const konfirmasiPembayaran = () => {
            const metodePembayaran = "cash"; // Set berdasarkan input pengguna
            const totalHarga = keranjang.reduce((total, item) => total + item.totalHarga, 0);

            if (metodePembayaran === "cash" && totalHarga > 0) {
                alert("Pembayaran berhasil lunas!");
            } else {
                alert("Pembayaran diarahkan ke halaman konfirmasi.");
            }
        };

        document.getElementById("tambahKeKeranjang").addEventListener("click", tambahItemKeKeranjang);
        document.getElementById("konfirmasiPembayaran").addEventListener("click", konfirmasiPembayaran);

        document.getElementById("idTransaksi").value = generateIDTransaksi();
        renderOptions("produk", produkList, "Pilih Produk");
        renderOptions("namaPelangganLain", pelangganList, "Pilih Pelanggan");
    </script>
</body>
</html>
